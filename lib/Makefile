# Build all libraries
C_STANDARD = c99

# Oh man.... this will be very messy.

INCLUDES    = -iquote. -I./paho.mqtt.embedded-c/MQTTPacket
INCLUDES   += -I./wakaama -I./wakaama/core


#SOURCES_MQTT_C  = paho.mqtt.embedded-c/MQTTPacket/src/MQTTConnectServer.c
SOURCES_MQTT_C  = paho.mqtt.embedded-c/MQTTPacket/src/MQTTConnectClient.c
SOURCES_MQTT_C += paho.mqtt.embedded-c/MQTTPacket/src/MQTTDeserializePublish.c
SOURCES_MQTT_C += paho.mqtt.embedded-c/MQTTPacket/src/MQTTFormat.c
SOURCES_MQTT_C += paho.mqtt.embedded-c/MQTTPacket/src/MQTTPacket.c
SOURCES_MQTT_C += paho.mqtt.embedded-c/MQTTPacket/src/MQTTSerializePublish.c
SOURCES_MQTT_C += paho.mqtt.embedded-c/MQTTPacket/src/MQTTSubscribeClient.c
SOURCES_MQTT_C += paho.mqtt.embedded-c/MQTTPacket/src/MQTTSubscribeServer.c
SOURCES_MQTT_C += paho.mqtt.embedded-c/MQTTPacket/src/MQTTUnsubscribeClient.c
SOURCES_MQTT_C += paho.mqtt.embedded-c/MQTTPacket/src/MQTTUnsubscribeServer.c

#SOURCES_COAP_C  = wakaama/core/er-coap-13/er-coap-13.c

SOURCES_COAP_C  = cantcoap/cantcoap.cpp

#SOURCES_UECC_C  = uECC/uECC.c

SOURCES_C  = $(SOURCES_MQTT_C) $(SOURCES_COAP_C) $(SOURCES_UECC_C)

FLAGS_LIBMQTT  =

#LOCAL_C_FLAGS = $(FLAGS_LIBCOAP)
LOCAL_C_FLAGS = -nostdlib $(FLAGS_LIBMQTT)


OBJS  = $(SOURCES_C:.c=.o)
LIBNAME = extraprotocols.a


all: $(LIBNAME)
	$(MAKE) -C mbedtls
	cp -RP mbedtls/library/libmbedtls.*    $(OUTPUT_PATH)
	cp -RP mbedtls/library/libmbedx509.*   $(OUTPUT_PATH)
	cp -RP mbedtls/library/libmbedcrypto.* $(OUTPUT_PATH)
#	$(MAKE) -C telehash-c

%.o : %.c
	$(CC) $(INCLUDES) $(CFLAGS) $(LOCAL_C_FLAGS) -std=$(C_STANDARD) -nostdlib -c $< -o $@


$(LIBNAME): $(OBJS)
	$(AR) -rvs $(OUTPUT_PATH)/$@ $(OBJS)


clean:
	rm -f $(OBJS)
	rm -f $(OUTPUT_PATH)/$(LIBNAME)
